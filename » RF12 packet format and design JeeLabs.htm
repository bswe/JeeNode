<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> » RF12 packet format and design JeeLabs</title>

<link rel="stylesheet" href="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/style.css" type="text/css" media="screen">
<!--[if gte IE 6]><link rel="stylesheet" href="http://jeelabs.org/wp-content/themes/depo-masthead/ie.css" type="text/css" media="screen" /><![endif]-->

<link rel="alternate" type="application/rss+xml" title="JeeLabs RSS Feed" href="http://jeelabs.org/feed/">
<link rel="pingback" href="http://jeelabs.org/xmlrpc.php">

<link rel="alternate" type="application/rss+xml" title="JeeLabs » RF12 packet format and design Comments Feed" href="http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/feed/">
<script type="text/javascript" src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/l10n.js"></script>
<script type="text/javascript" src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/jquery.js"></script>
<script type="text/javascript" src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/comment-reply.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://jeelabs.org/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://jeelabs.org/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="JeeLabs" href="http://jeelabs.org/">
<link rel="start" title="Arduino" href="http://jeelabs.org/2008/10/25/arduino/">
<link rel="prev" title="How the JeeNode evolved" href="http://jeelabs.org/2011/06/08/how-the-jeenode-evolved/">
<link rel="next" title="RF12 broadcasts and ACKs" href="http://jeelabs.org/2011/06/10/rf12-broadcasts-and-acks/">
<meta name="generator" content="WordPress 3.2.1">
<link rel="canonical" href="http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/">
<link rel="shortlink" href="http://jeelabs.org/?p=13772">

<!-- Bad Behavior 2.1.15 run time: 41.730 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1321142535 75.32.239.196 75.32.239.196';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		<script type="text/javascript" src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/audio-player.js"></script>
<script type="text/javascript">
	AudioPlayer.setup("http://jeelabs.org/wp-content/plugins/degradable-html5-audio-and-video/incl/player.swf", {
		/* Format the player by inserting lines here. See http://wpaudioplayer.com/standalone */
		width: 290,
		initialvolume: 80
	});
</script><style type="text/css">.broken_link, a.broken_link {
	text-decoration: line-through;
}</style><style type="text/css">.removed_link, a.removed_link {
	text-decoration: line-through;
}</style>
<script type="text/javascript" charset="utf-8">
/*<![CDATA[ */
//set title font size
jQuery(document).ready(function() {
	
	function resize(selector, max) {
		jQuery(selector).each(function() {

			var width = jQuery(this).width();
			var height = jQuery(this).height();
			if(width > max) {
			var r = ( height / width );
			var w = max;
			var h = ( w * r );
			jQuery(this).height(h).width(w);
		}});
	}
	
	resize('#home .gallery img', 90);
	resize('#home .entry img', 300);
	resize('#home .wp-caption img', 290);
	resize('#home .wp-caption', 300);
	jQuery('#home .wp-caption').css('height', 'auto');
});
/* ]]> */
</script>
</head>
<body>
<div id="page">

<h1 class="name"><a href="http://jeelabs.org/" title="Computing stuff tied to the physical world"><span>
		Computing stuff tied to the physical world</span></a></h1>

<div id="container">
	<div class="sleeve">
		
		<div id="header">
						<h1 style="font-size: 120px;">
			<a href="http://jeelabs.org/" title="Computing stuff tied to the physical world">			JeeLabs			</a>			</h1>

			<ul id="menu">
				<li><a href="http://jeelabs.org/intro/">Intro</a><span>|</span></li><li><a href="http://jeelabs.org/cafe/">Café • Docs</a><span>|</span></li><li><a href="http://jeelabs.org/talk/">Talk • Forum</a><span>|</span></li><li><a href="http://jeelabs.org/shop/">Shop</a><span>|</span></li><li><a href="http://jeelabs.org/about/">About</a><span>|</span></li>			<li>
				<a href="http://jeelabs.org/2011/">Archives</a><span>|</span>
			</li>
			<li>
				<a href="http://jeelabs.org/feed/">RSS Feed</a>
			</li>
			
			</ul>

		</div>

		<div id="content" class="group">
	
					<div class="post-13772 post type-post status-publish format-standard hentry category-software tag-network" id="post-13772">
						<p class="postmetadata"><a href="http://jeelabs.org/tag/network/" rel="tag">Network</a><br></p>
						<h2>RF12 packet format and design</h2>
						<small>In <a href="http://jeelabs.org/category/software/" title="View all posts in Software" rel="category tag">Software</a> on <strong>Jun 9, 2011</strong> at <strong>00:01</strong></small>

						<div class="entry">
							<p>The <a href="http://jeelabs.net/projects/cafe/wiki/RF12">RF12 library</a> contains the code to support the RFM12B wireless module in an Arduino-like environment. It’s used for <a href="http://jeelabs.org/jn6">JeeNodes</a> but also in several projects by others.</p>

<p>Here’s the general structure of a packet, as supported by the RF12 driver:</p>

<p><img src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/RF12-packets.png" alt=""></p>

<p>I made quite a few design decisions in the RF12 driver. One of the 
goals was to make the communication work in the background, so the 
driver is fully interrupt-driven. An important choice was to limit the 
packet size to 66 bytes of payload, to keep RAM use low and still allow 
just over 64 bytes of payload, enough to send data in 64-byte chunks 
with a <em>teeny</em> bit of additional info.</p>

<p>Another major design decision was to support absolutely minimal 
packet sizes. This directly affects the power consumption, because 
longer packets take more time, and the longer the receiver and 
transmitter are on, the more precious battery power they will consume. 
For this same reason, the transmission bit rate is set fairly high 
(about 50 kbits/sec) – a higher rate means the same message can be sent 
in less time. A higher rate also makes it harder for the receiver to 
still pick up a good packet, so I didn’t want to push this to the limit.</p>

<p>This is how the RF12 driver can support really short packets:</p>

<ul>
<li>the network group is one byte and also doubles as second SYN byte</li>
<li>the node ID is small enough (5 bits) to allow a few more header bits in the same byte</li>
<li>there are only three header bits, as described in more detail in tomorrow’s post</li>
<li>there is only room for <em>either</em> the source node ID <em>or</em> the destination node ID</li>
</ul>

<p>That last decision is a bit unusual. It means an incoming packet can <em>only</em> inform the receiver where it came from, <em>or</em> define which receiver the packet is intended for – not both.</p>

<p>This may seem like a severe limitation, but it really isn’t: just add
 the missing info in the payload and agree on a convention so that the 
receiver can pick it up. All the RF12 does is enforce a truly minimal 
design, you can add any info you like as payload.</p>

<p>As a result, a minimal packet has the following format:</p>

<p><img src="%C2%BB%20RF12%20packet%20format%20and%20design%20JeeLabs_files/rf12-minimal.png" alt=""></p>

<p>That’s 9 bytes, i.e. 72 bits – which means that a complete (but empty) packet can be sent out in less than 1.5 ms.</p>

<p><em>Tomorrow, I’ll describe the exact logic used in the HDR byte, and how to use broadcasts and ACKs.</em></p>
														 
						</div>
					</div>

					<div id="showcomments"><a href="#comments">▶ View 1 Comment</a></div>

<div style="display: block;" id="comments">

<script type="text/javascript" charset="utf-8">
/*<![CDATA[ */
// comment hide/show mechanism
	jQuery(document).ready(function() {
		check_location();			
		function check_location(trick) {
			if(trick != 'hide' && window.location.href.indexOf('#comment') > 0) {
				jQuery('#comments').show('', change_location());
				jQuery('#showcomments a .closed').css('display', 'none');
				jQuery('#showcomments a .open').css('display', 'inline');
				return true;
			} else {
				jQuery('#comments').hide('');
				jQuery('#showcomments a .closed').css('display', 'inline');
				jQuery('#showcomments a .open').css('display', 'none');
				return false;
			}
		}
		jQuery('#showcomments a').click(function(){
			if(jQuery('#comments').css('display') == 'none') {
				self.location.href = '#comments';
				check_location();
			} else {
				check_location('hide');
			}
		});
		function change_location() {
			self.location.href = '#comments';
		}
	});
/* ]]> */
</script>


	<ol class="commentlist">

		<li class="comment even thread-even depth-1" id="comment-3302">
	<div id="div-comment-3302">
		<div class="comments_text">
		<p>Great timing with this series JC, I’ve just been mulling over the 
design of a wide spread network of nodes, where I’m hoping all the nodes
 can relay on messages, which aren’t purely for them, to all the others 
in range (with a decremented TTL counter to stop messages going round 
for ever!).</p>				
		<div class="reply">
					</div>
		</div>
			
		<div class="comment-meta commentmetadata">
			<div class="gravatar"></div>
			<div class="cite comment-author vcard">
			<cite class="fn">TankSlappa</cite>
			<small><a href="#comment-3302" title=""><strong>9 June 2011</strong> at <strong>2pm</strong></a> </small>
			</div>
		</div>
	</div>
</li>
	</ol>
	
	<div class="commentnavigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>	

			<p class="nocomments">Comments are closed.</p>
	

</div>
					
					<div class="navigation">
						<div class="previous">
								<a href="http://jeelabs.org/2011/06/08/how-the-jeenode-evolved/" rel="prev"><span class="arrow">«</span> <span class="link"> <span class="before">Before</span> <span class="title">How the JeeNode evolved</span> <span class="date">Jun 8, 2011</span> </span></a>						</div>
						
						<div class="next">
								<a href="http://jeelabs.org/2011/06/10/rf12-broadcasts-and-acks/" rel="next"><span class="link"> <span class="after">After</span><span class="title">RF12 broadcasts and ACKs</span> <span class="date">Jun 10, 2011</span></span> <span class="arrow">»</span></a>						</div>
						<div class="clear"></div>
					</div>
			</div>
	</div>
	<div id="sidebar">
		<div class="sleeve">
		<ul class="group">
			<li id="left_sidebar">
			<ul>
					<li id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widgettitle">Recent Posts</h3>		<ul>
				<li><a href="http://jeelabs.org/2011/11/13/capacitive-transformer-less-supply/" title="Capacitive transformer-less supply">Capacitive transformer-less supply</a></li>
				<li><a href="http://jeelabs.org/2011/11/12/meet-the-slave-plug/" title="Meet the Slave Plug">Meet the Slave Plug</a></li>
				<li><a href="http://jeelabs.org/2011/11/11/pulsing-the-led-strip/" title="Pulsing the LED strip">Pulsing the LED strip</a></li>
				<li><a href="http://jeelabs.org/2011/11/10/pins-damned-pins-and-jeenodes/" title="Pins, damned pins, and JeeNodes">Pins, damned pins, and JeeNodes</a></li>
				<li><a href="http://jeelabs.org/2011/11/09/fixing-the-arduinos-pwm-2/" title="Fixing the Arduino’s PWM #2">Fixing the Arduino’s PWM #2</a></li>
				<li><a href="http://jeelabs.org/2011/11/08/fixing-the-arduinos-pwm/" title="Fixing the Arduino’s PWM">Fixing the Arduino’s PWM</a></li>
				<li><a href="http://jeelabs.org/2011/11/07/jeenode-usb-problems/" title="JeeNode USB problems">JeeNode USB problems</a></li>
				<li><a href="http://jeelabs.org/2011/11/06/lets-use-leds/" title="Let’s use LEDs">Let’s use LEDs</a></li>
				<li><a href="http://jeelabs.org/2011/11/05/a-color-shifting-led-node/" title="A color-shifting LED Node">A color-shifting LED Node</a></li>
				<li><a href="http://jeelabs.org/2011/11/04/a-sketch-for-the-lednode/" title="A sketch for the LED Node">A sketch for the LED Node</a></li>
				<li><a href="http://jeelabs.org/2011/11/03/meet-the-lednode/" title="Meet the LED Node">Meet the LED Node</a></li>
				<li><a href="http://jeelabs.org/2011/11/02/running-led-ticker-2/" title="Running LED ticker #2">Running LED ticker #2</a></li>
				<li><a href="http://jeelabs.org/2011/11/01/running-led-ticker/" title="Running LED ticker">Running LED ticker</a></li>
				<li><a href="http://jeelabs.org/2011/10/31/permanent-lcd-display/" title="Permanent LCD display">Permanent LCD display</a></li>
				<li><a href="http://jeelabs.org/2011/10/30/driven-by-passion/" title="Driven by passion">Driven by passion</a></li>
				</ul>
		</li>				
						</ul>
			</li>
			
			<li id="middle_sidebar">
			<ul>
						
			<li id="depo_archives">
	<h2>Archives</h2>
	<ul>
		<li><a href="http://jeelabs.org/2011/11/" title="November 2011">November 2011</a></li>
	<li><a href="http://jeelabs.org/2011/10/" title="October 2011">October 2011</a></li>
	<li><a href="http://jeelabs.org/2011/09/" title="September 2011">September 2011</a></li>
	<li><a href="http://jeelabs.org/2011/06/" title="June 2011">June 2011</a></li>
	<li><a href="http://jeelabs.org/2011/05/" title="May 2011">May 2011</a></li>
	<li><a href="http://jeelabs.org/2011/03/" title="March 2011">March 2011</a></li>
	<li><a href="http://jeelabs.org/2011/02/" title="February 2011">February 2011</a></li>
	<li><a href="http://jeelabs.org/2011/01/" title="January 2011">January 2011</a></li>
	<li><a href="http://jeelabs.org/2010/12/" title="December 2010">December 2010</a></li>
	<li><a href="http://jeelabs.org/2010/11/" title="November 2010">November 2010</a></li>
	<li><a href="http://jeelabs.org/2010/10/" title="October 2010">October 2010</a></li>
	<li><a href="http://jeelabs.org/2010/09/" title="September 2010">September 2010</a></li>
	<li><a href="http://jeelabs.org/2010/08/" title="August 2010">August 2010</a></li>
	<li><a href="http://jeelabs.org/2010/07/" title="July 2010">July 2010</a></li>
	<li><a href="http://jeelabs.org/2010/06/" title="June 2010">June 2010</a></li>
	<li><a href="http://jeelabs.org/2010/05/" title="May 2010">May 2010</a></li>
	<li><a href="http://jeelabs.org/2010/04/" title="April 2010">April 2010</a></li>
	<li><a href="http://jeelabs.org/2010/03/" title="March 2010">March 2010</a></li>
	<li><a href="http://jeelabs.org/2010/02/" title="February 2010">February 2010</a></li>
	<li><a href="http://jeelabs.org/2010/01/" title="January 2010">January 2010</a></li>
	<li><a href="http://jeelabs.org/2009/12/" title="December 2009">December 2009</a></li>
	<li><a href="http://jeelabs.org/2009/11/" title="November 2009">November 2009</a></li>
	<li><a href="http://jeelabs.org/2009/10/" title="October 2009">October 2009</a></li>
	<li><a href="http://jeelabs.org/2009/09/" title="September 2009">September 2009</a></li>
	<li><a href="http://jeelabs.org/2009/08/" title="August 2009">August 2009</a></li>
	<li><a href="http://jeelabs.org/2009/07/" title="July 2009">July 2009</a></li>
	<li><a href="http://jeelabs.org/2009/06/" title="June 2009">June 2009</a></li>
	<li><a href="http://jeelabs.org/2009/05/" title="May 2009">May 2009</a></li>
	<li><a href="http://jeelabs.org/2009/04/" title="April 2009">April 2009</a></li>
	<li><a href="http://jeelabs.org/2009/03/" title="March 2009">March 2009</a></li>
	<li><a href="http://jeelabs.org/2009/02/" title="February 2009">February 2009</a></li>
	<li><a href="http://jeelabs.org/2009/01/" title="January 2009">January 2009</a></li>
	<li><a href="http://jeelabs.org/2008/12/" title="December 2008">December 2008</a></li>
	<li><a href="http://jeelabs.org/2008/11/" title="November 2008">November 2008</a></li>
	<li><a href="http://jeelabs.org/2008/10/" title="October 2008">October 2008</a></li>
	</ul>
	
	<ul>
			<li class="cat-item cat-item-3"><a href="http://jeelabs.org/category/avr/" title="AVR">AVR</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://jeelabs.org/category/hardware/" title="Hardware">Hardware</a>
</li>
	<li class="cat-item cat-item-25"><a href="http://jeelabs.org/category/musings/" title="Musings">Musings</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://jeelabs.org/category/news/" title="News">News</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://jeelabs.org/category/software/" title="Software">Software</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://jeelabs.org/category/uncategorized/" title="Uncategorized">Uncategorized</a>
</li>
	</ul>
	<br class="clear">
</li>
			
						</ul>
			</li>
			
			<li id="right_sidebar">
			<ul>
			<li id="text-3" class="widget widget_text"><h3 class="widgettitle">About</h3>			<div class="textwidget">"Jee" is an acronym for JC's environmental electronics. This blog is maintained by Jean-Claude Wippler.</div>
		</li>	<li id="search_widget" class="widget widget_search">
<form method="get" id="searchform" action="http://jeelabs.org/">
<label class="hidden" for="s">Search for:</label>
<div><input name="s" id="s" type="text">
<input id="searchsubmit" value="Search" type="submit">
</div>
</form></li><li id="text-4" class="widget widget_text">			<div class="textwidget"><a href="http://jeelabs.org/pub/index-a.html"><i>Alphabetical</i></a> and <a href="http://jeelabs.org/pub/index-c.html"><i>Chronological</i></a> index of 800 weblog posts.</div>
		</li>	<li id="rss_link" class="widget widget_rss"><a href="http://jeelabs.org/feed/">RSS Feed</a></li>

									</ul>
			</li>

		</ul>
		<div class="closer"></div>
		</div>
	</div>
</div>
	<div id="footer">
		<p>
			Theme: <strong>DePo Masthead</strong> by <a href="http://powazek.com/" rel="designer">Derek Powazek</a>
			
		</p>
	</div>
</div>






</body></html>
<!-- Dynamic page generated in 0.313 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-11-13 01:02:15 -->
<!-- Compression = gzip -->